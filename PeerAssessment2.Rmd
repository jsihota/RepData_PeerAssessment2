#### Reproducible Research- Peer Assessment 2
#### Most Severe Weather Events Impacting Health and Economy
##### author: jagdeep s sihota


#Synopsis
  This anyalis involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) 
storm database two answer following questions:

- Across the United States, which types of events  are most harmful with respect to population health?
- Across the United States, which types of events have the greatest economic consequences?

  This NOAA database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.The raw data consisted of 902297 records, each with values for up to 37 variables, from years 1950 to November 2011.
  
  Data shows, tornadoes are the most hazardous to human health with 5633 reported fatalities and 91346 reported injuries, and floods have been responsible for the most economic damage ($150+ billion).

## Data Processing
### Setting up R

```{r settings,message=F,cache=F, warning=F}
library(knitr)
options(digits = 7)
opts_chunk$set(fig.width=10)
```

```{r libraries,message=F,cache=F, warning=F}
library(R.utils, warn.conflicts = FALSE, quietly=TRUE)
library(data.table, warn.conflicts = FALSE, quietly=TRUE)
library(ggplot2, warn.conflicts = FALSE, quietly=TRUE)
```
### Loading the data
Raw data is available at the Coursera "Reproducible Research" course
[csv.bz2 file](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2). 


```{r download.data,cache=F,eval=T}
# download file from URL
if (!file.exists("repdata-data-StormData.csv.bz2")) {
download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", destfile="repdata-data-StormData.csv.bz2",method = "curl")
}
# unzip file
if (!file.exists("storm.csv")) {
    library(R.utils)
    bunzip2("repdata-data-StormData.csv.bz2", "storm.csv", remove = FALSE)
}
```

Read in the extracted file, which is in CSV format
```{r read.data,cache=F,eval=T}
# load data into R
storm <- read.csv("storm.csv")
head(storm)
```

### Processeing Data
Only subset of this data is relevant to health and economic impact analysis against weather.
A detailed description columns can be found in this [pdf file](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)

```{r subset.data,cache=F,eval=T}
relevantCol <- c("EVTYPE", "FATALITIES", "INJURIES", "PROPDMG", "PROPDMGEXP", "CROPDMG", "CROPDMGEXP")
stormRelevantData <- storm[relevantCol]
names(stormRelevantData)
```
### Data Cleanup 
Convert the property damage and crop damage data into comparable numerical values
```{r cleanup.data,cache=F,eval=T}
# storing the property exponent data
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "K"] <- 1000
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "M"] <- 1e+06
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == ""] <- 1
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "B"] <- 1e+09
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "m"] <- 1e+06
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "0"] <- 1
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "5"] <- 1e+05
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "6"] <- 1e+06
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "4"] <- 10000
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "2"] <- 100
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "3"] <- 1000
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "h"] <- 100
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "7"] <- 1e+07
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "H"] <- 100
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "1"] <- 10
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "8"] <- 1e+08
# give 0 to invalid exponent data, so they not count in
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "+"] <- 0
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "-"] <- 0
stormRelevantData$PROPEXP[stormRelevantData$PROPDMGEXP == "?"] <- 0
# compute the property damage value
stormRelevantData$PROPDMGVAL <- stormRelevantData$PROPDMG * stormRelevantData$PROPEXP

# exploring the crop exponent data
unique(stormRelevantData$CROPDMGEXP)
# Sorting the property exponent data
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "M"] <- 1e+06
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "K"] <- 1000
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "m"] <- 1e+06
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "B"] <- 1e+09
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "0"] <- 1
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "k"] <- 1000
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "2"] <- 100
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == ""] <- 1
# give 0 to invalid exponent data, so they not count in
stormRelevantData$CROPEXP[stormRelevantData$CROPDMGEXP == "?"] <- 0
# compute the crop damage value
stormRelevantData$CROPDMGVAL <- stormRelevantData$CROPDMG * stormRelevantData$CROPEXP

head(stormRelevantData)
```